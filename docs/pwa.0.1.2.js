!function(e){function t(t){for(var a,o,l=t[0],c=t[1],s=t[2],d=0,p=[];d<l.length;d++)o=l[d],r[o]&&p.push(r[o][0]),r[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);for(u&&u(t);p.length;)p.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,l=1;l<n.length;l++){var c=n[l];0!==r[c]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={0:0},i=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window.webpackJsonp=window.webpackJsonp||[],c=l.push.bind(l);l.push=t,l=l.slice();for(var s=0;s<l.length;s++)t(l[s]);var u=c;i.push([37,2]),n()}({35:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(12),o=n.n(i),l=n(40),c=n(39),s=n(41),u=n(1);let d=Number(localStorage.getItem("entry_id"))||0;function p(){const e=String(++d);return localStorage.setItem("entry_id",e),e}var h=n(9),m=n(20),g=function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function l(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,l)}c((a=a.apply(e,t||[])).next())})};class y extends m.a{constructor(e={}){e.placeholders=[{keys:["{{timestamp}}"],flags:"gi",replacer:()=>{let e=new Date;return`${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}.${e.getMilliseconds()}`}},{keys:["{{service}}"],flags:"gi",replacer:(e,t)=>t?`${t.service}`:"error_service"}],super(e)}construct(e){return g(this,void 0,void 0,function*(){return this.internals.service="CONSTRUCTOR",this.custom(this.options,this.internals,`Component ${e}`)})}}const f=new y({prefix:"{{timestamp}} [DB -- {{service}}] "}),E=new y({prefix:"{{timestamp}} [REDUX -- {{service}}] "}),v=new y({prefix:"{{timestamp}} [{{service}}] "});var w=function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function l(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,l)}c((a=a.apply(e,t||[])).next())})};const b=h.createInstance({name:"repeat"});function S(e){return w(this,void 0,void 0,function*(){return f.log("add Repeat"),yield b.setItem(e.id,e),e})}const T="ADD_REPEAT",C="SET_REPEATS";var x=n(8);const D="ADD_ENTRY",I="REMOVE_ENTRY",k="SET_ENTRIES",B="ADD_ENTRIES";let O=x.c(x.b({entryReducer:function(e=[],t){switch(E.log("call entry-reducer with action "+t.type),t.type){case D:if(!t.entry)throw new Error("tries to add an empty entry");let n=(e=[...e]).findIndex(e=>!(!t.entry||e.id!==t.entry.id));return-1!==n&&e.splice(n,1),e.push(t.entry),e.sort((e,t)=>{const n=new Date(e.date);return new Date(t.date).getTime()-n.getTime()}),e;case B:if(!t.entries)throw new Error("tries to add an empty entry");return(e=e.concat(t.entries)).sort((e,t)=>{const n=new Date(e.date);return new Date(t.date).getTime()-n.getTime()}),e;case I:if(!t.entry)throw new Error("tries to remove an empty entry");return t.entry,e.filter(e=>e.id!==t.entry.id);case k:if(!t.entries)throw new Error("tries to set the state to null|undefined");return t.entries}return e},generatorReducer:function(e=[],t){return E.log("call repeat-reducer with action "+t.type),e}}));var _=function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function l(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,l)}c((a=a.apply(e,t||[])).next())})};const R=h.createInstance({name:"entry"});function M(e){return _(this,void 0,void 0,function*(){return f.log("add entry"),yield R.setItem(e.id,e),e})}var P=function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function l(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,l)}c((a=a.apply(e,t||[])).next())})};function j(){return P(this,void 0,void 0,function*(){let e=yield function(){return _(this,void 0,void 0,function*(){f.log("get all entries");let e=[];return yield R.iterate(t=>{e.push(t)}),e.sort((e,t)=>{const n=new Date(e.date);return new Date(t.date).getTime()-n.getTime()}),e})}();O.dispatch(function(e){return E.log("create setentries action"),{type:k,entries:e}}(e))})}function H(){return P(this,void 0,void 0,function*(){let e=yield function(){return w(this,void 0,void 0,function*(){f.log("get all repeats");let e=[];return yield b.iterate(t=>{e.push(t)}),e})}();return O.dispatch(function(e){return E.log("create setentries action"),{type:C,repeats:e}}(e)),e})}function A(e,t){return P(this,void 0,void 0,function*(){let n=new Date(e.begin),a=t||new Date<new Date(e.end)?new Date:new Date(e.end);a=new Date(a.setDate(a.getDate()+1));let r=[];for(;n<a;)"weekly"===e.repeattype?e.repeats.indexOf(n.getDay())>=0&&r.push(Object.assign({},e.template,{date:n.toISOString()})):e.repeats.indexOf(n.getDate())>=0&&r.push(Object.assign({},e.template,{date:n.toISOString()})),n.setDate(n.getDate()+1);return r})}function N(){return P(this,void 0,void 0,function*(){let e=yield H();for(const t of e){let e=yield A(t);console.log(e),e.map(e=>(e.id=p(),e)),yield $(e);let n=new Date;n.setDate(n.getDate()+1),t.begin=n.toISOString(),yield L(t)}})}function z(e){return P(this,void 0,void 0,function*(){yield M(e),O.dispatch(function(e){return E.log("create add action"),{type:D,entry:e}}(e))})}function $(e){return P(this,void 0,void 0,function*(){O.dispatch(function(e){return E.log("create setentries action"),{type:B,entries:e}}(e));for(let t of e)yield M(t)})}function L(e){return P(this,void 0,void 0,function*(){yield S(e)})}function F(e){return P(this,void 0,void 0,function*(){yield function(e){return _(this,void 0,void 0,function*(){return f.log("remove entry "+e.id),yield R.removeItem(e.id),e})}(e),O.dispatch(function(e){return E.log("create remove action"),{type:I,entry:e}}(e))})}var W=function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function l(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,l)}c((a=a.apply(e,t||[])).next())})};class K extends r.a.Component{constructor(e){v.construct("addpage"),super(e),this.input_entry={date:(new Date).toISOString(),id:"",note:"",value:0,category:"default"},this.input_repeat={begin:(new Date).toISOString(),end:(new Date).toISOString(),id:"",template:this.input_entry,repeats:[],repeattype:"weekly"},this.state={pagestate:"entry",repeattype:"weekly"},this.handleSubmit=this.handleSubmit.bind(this),this.renderToolbar=this.renderToolbar.bind(this),this.renderRepeatInput=this.renderRepeatInput.bind(this),this.renderBottomToolbar=this.renderBottomToolbar.bind(this)}render(){return"backToHome"===this.state.pagestate?r.a.createElement(s.a,{to:"/"}):r.a.createElement(u.Page,{renderToolbar:this.renderToolbar,renderBottomToolbar:this.renderBottomToolbar},r.a.createElement(u.Card,null,r.a.createElement(u.Row,null,r.a.createElement(u.Col,{style:{lineHeight:"24px"}},"Wiederholung"),r.a.createElement(u.Switch,{onChange:()=>this.setState({pagestate:"entry"!==this.state.pagestate?"entry":"repeat"})}))),"entry"===this.state.pagestate&&this.renderEntryInput(),"repeat"===this.state.pagestate&&this.renderRepeatInput())}renderToolbar(){return r.a.createElement(u.Toolbar,null,r.a.createElement(u.ToolbarButton,{onClick:()=>this.setState({pagestate:"backToHome"})},r.a.createElement(u.BackButton,null)),r.a.createElement("h4",{style:{margin:0,lineHeight:"60px"}},"Erstelle ","entry"===this.state.pagestate?"Eintrag":"Wiederholung"))}renderBottomToolbar(){return r.a.createElement(u.BottomToolbar,null,r.a.createElement(u.ToolbarButton,{style:{margin:0,padding:0,lineHeight:"44px",width:"100%",textAlign:"center"},onClick:this.handleSubmit},"Hinzufügen"))}renderEntryInput(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},placeholder:"Kategorie:",onChange:e=>this.input_entry.category=e.target.value})),r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},type:"date",placeholder:"Datum:",onChange:e=>this.input_entry.date=new Date(e.target.value).toISOString()})),r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},type:"number",placeholder:"Wert:",onChange:e=>this.input_entry.value=Number(e.target.value)})))}renderRepeatInput(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},placeholder:"Kategorie:",onChange:e=>this.input_entry.category=e.target.value})),r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},type:"number",placeholder:"Wert:",onChange:e=>this.input_entry.value=Number(e.target.value)})),r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},type:"date",placeholder:"Begin:",onChange:e=>this.input_repeat.begin=new Date(e.target.value).toISOString()})),r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},type:"date",placeholder:"Ende:",onChange:e=>this.input_repeat.end=new Date(e.target.value).toISOString()})),r.a.createElement(u.Card,null,r.a.createElement(u.Row,null,r.a.createElement(u.Col,null,r.a.createElement(u.Button,{modifier:"weekly"===this.state.repeattype?"cta":"light",style:{width:"100%"},onClick:()=>this.setState({repeattype:"weekly"})},"Wöchentlich")),r.a.createElement(u.Col,null,r.a.createElement(u.Button,{modifier:"weekly"!==this.state.repeattype?"cta":"light",style:{width:"100%"},onClick:()=>this.setState({repeattype:"monthly"})},"Monatlich")))),"weekly"===this.state.repeattype&&r.a.createElement(u.Card,null,r.a.createElement(u.Select,{id:"weeklyrepeats",style:{width:"100%"},multiple:!0,onChange:e=>{let t=document.querySelectorAll("#weeklyrepeats option:checked");this.input_repeat.repeats=Array.from(t).map(e=>Number(e.value))}},r.a.createElement("option",{value:"1"},"Montag"),r.a.createElement("option",{value:"2"},"Dienstag"),r.a.createElement("option",{value:"3"},"Mittwoch"),r.a.createElement("option",{value:"4"},"Donnerstag"),r.a.createElement("option",{value:"5"},"Freitag"),r.a.createElement("option",{value:"6"},"Samstag"),r.a.createElement("option",{value:"0"},"Sonntag"))),"monthly"===this.state.repeattype&&r.a.createElement(u.Card,null,r.a.createElement(u.Select,{id:"monthlyrepeats",style:{width:"100%"},multiple:!0,onChange:e=>{let t=document.querySelectorAll("#monthlyrepeats option:checked");this.input_repeat.repeats=Array.from(t).map(e=>Number(e.value))}},r.a.createElement("option",{value:"1"},"1"),r.a.createElement("option",{value:"2"},"2"),r.a.createElement("option",{value:"3"},"3"),r.a.createElement("option",{value:"4"},"4"),r.a.createElement("option",{value:"5"},"5"),r.a.createElement("option",{value:"6"},"6"),r.a.createElement("option",{value:"7"},"7"),r.a.createElement("option",{value:"8"},"8"),r.a.createElement("option",{value:"9"},"9"),r.a.createElement("option",{value:"10"},"10"),r.a.createElement("option",{value:"11"},"11"),r.a.createElement("option",{value:"12"},"12"),r.a.createElement("option",{value:"13"},"13"),r.a.createElement("option",{value:"14"},"14"),r.a.createElement("option",{value:"15"},"15"),r.a.createElement("option",{value:"16"},"16"),r.a.createElement("option",{value:"17"},"17"),r.a.createElement("option",{value:"18"},"18"),r.a.createElement("option",{value:"19"},"19"),r.a.createElement("option",{value:"20"},"20"),r.a.createElement("option",{value:"21"},"21"),r.a.createElement("option",{value:"22"},"22"),r.a.createElement("option",{value:"23"},"23"),r.a.createElement("option",{value:"24"},"24"),r.a.createElement("option",{value:"25"},"25"),r.a.createElement("option",{value:"26"},"26"),r.a.createElement("option",{value:"27"},"27"),r.a.createElement("option",{value:"28"},"28"))))}handleSubmit(){return W(this,void 0,void 0,function*(){if("entry"===this.state.pagestate){const e=Object.assign({},this.input_entry,{id:p()});yield z(e)}else{const e=Object.assign({},this.input_repeat,{id:p(),repeattype:this.state.repeattype});yield S(e),O.dispatch(function(e){return E.log("create add action"),{type:T,repeat:e}}(e))}this.setState({pagestate:"backToHome"})})}}n(32),n(33);var U=n(11);let Y=0;const q=[["version: 0.1.2",void 0]],J=Object(U.b)(function(e){return{entries:e.entryReducer,repeats:e.repeatsReducer}},null)(class extends r.a.Component{constructor(e){v.construct("homepage"),super(e),this.state={total:0,slice:0,openMenu:!1},N(),this.MenuLeft=this.MenuLeft.bind(this),this.renderToolbar=this.renderToolbar.bind(this),this.renderBottomToolbar=this.renderBottomToolbar.bind(this)}render(){if(this.state.redirect)return r.a.createElement(s.a,{to:this.state.redirect});v.info("RENDER homepage");let e=[];return r.a.createElement(u.Splitter,null,r.a.createElement(u.SplitterSide,{side:"left",collapse:!0,width:200,isOpen:this.state.openMenu,onClose:()=>{this.setState({openMenu:!1})},swipeable:!0},r.a.createElement(u.Page,null,r.a.createElement(this.MenuLeft,null))),r.a.createElement(u.SplitterContent,null,r.a.createElement(u.Page,{renderToolbar:this.renderToolbar,renderBottomToolbar:this.renderBottomToolbar},r.a.createElement(u.List,{dataSource:this.props.entries.slice(20*this.state.slice,20*(1+this.state.slice)),renderRow:t=>r.a.createElement(r.a.Fragment,{key:t.id||`tmp_${++Y}`},e.indexOf(new Date(t.date).toDateString())<0&&(()=>(e.push(new Date(t.date).toDateString()),!0))()&&r.a.createElement(u.ListItem,{className:"homepage_date",modifier:"nodivider"},r.a.createElement(u.Row,null,r.a.createElement(u.Col,null,new Date(t.date).toDateString()))),r.a.createElement(u.ListItem,{modifier:"longdivider"},r.a.createElement(u.Row,null,r.a.createElement(u.Col,null,t.category),!(this.state.active&&this.state.active.id===t.id)&&r.a.createElement(u.Col,{width:"100px"},t.value,"€"),r.a.createElement(u.Col,{width:"50px"},r.a.createElement(u.Button,{onClick:()=>this.setState({active:this.state.active&&this.state.active.id===t.id?void 0:t}),modifier:"light"},r.a.createElement(u.Icon,{icon:this.state.active&&this.state.active.id===t.id?"ion-close-round":"ion-chevron-left",size:{default:22}}))),this.state.active&&this.state.active.id===t.id&&r.a.createElement(u.Col,{width:"50px"},r.a.createElement(u.Button,{modifier:"light",onClick:()=>{this.setState({redirect:"/edit/"+t.id})}},r.a.createElement(u.Icon,{icon:"ion-wrench",size:{default:22}}))),this.state.active&&this.state.active.id===t.id&&r.a.createElement(u.Col,{width:"50px"},r.a.createElement(u.Button,{modifier:"light",onClick:()=>{F(t)}},r.a.createElement(u.Icon,{icon:"ion-trash-b",size:{default:22}}))))))}),r.a.createElement(u.Fab,{style:{position:"fixed",bottom:"50px",right:"10px"},onClick:()=>this.setState({redirect:"/add"})},r.a.createElement(u.Icon,{icon:{default:"fa-plus"},size:{default:32}})))))}MenuLeft(){return r.a.createElement(u.List,{dataSource:q,renderRow:e=>r.a.createElement(u.ListItem,{key:"tmp_"+ ++Y,onClick:()=>{e[1]&&this.setState({redirect:e[1]})}},e[0])})}renderToolbar(){return r.a.createElement(u.Toolbar,null,r.a.createElement(u.ToolbarButton,{onClick:()=>this.setState({openMenu:!0})},r.a.createElement(u.Icon,{icon:{default:"ion-navicon"},size:{default:50}})),r.a.createElement("h3",{style:{paddingRight:"20px",margin:0,lineHeight:"60px",textAlign:"right",width:"100%"}},function(e){let t=0;for(const n of e)t+=n.value;return t}(this.props.entries).toFixed(2)," €"))}renderBottomToolbar(){return r.a.createElement(u.BottomToolbar,null,r.a.createElement(u.Row,null,r.a.createElement(u.ToolbarButton,{onClick:()=>this.setState({slice:0===this.state.slice?this.state.slice:this.state.slice-1})},r.a.createElement(u.Icon,{icon:{default:"ion-chevron-left"},size:{default:30},style:{paddingTop:"5px"}})),r.a.createElement(u.Col,{style:{textAlign:"center",lineHeight:"44px"}},20*this.state.slice+1,"-",20*(1+this.state.slice)," von ",this.props.entries.length),r.a.createElement(u.ToolbarButton,{onClick:()=>this.setState({slice:20*(this.state.slice+1)<this.props.entries.length?this.state.slice+1:this.state.slice})},r.a.createElement(u.Icon,{icon:{default:"ion-chevron-right"},size:{default:30},style:{paddingTop:"5px"}}))))}}),V={value:0,date:(new Date).toISOString(),note:"",id:"-1",category:"default"};var X=function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function l(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,l)}c((a=a.apply(e,t||[])).next())})};class G extends r.a.Component{constructor(e){super(e),this.state={pagestate:"none",tmpEntry:Object.assign({},V)},this.tmpEntry=Object.assign({},V,{id:p()}),function(e){return _(this,void 0,void 0,function*(){return f.log("get entry #"+e),yield R.getItem(e)})}(this.props.match.params.entry_id).then(e=>{e&&this.setState({tmpEntry:e})}),this.renderToolbar=this.renderToolbar.bind(this),this.renderBottomToolbar=this.renderBottomToolbar.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}render(){return"backToHome"===this.state.pagestate?r.a.createElement(s.a,{to:"/"}):r.a.createElement(u.Page,{renderToolbar:this.renderToolbar,renderBottomToolbar:this.renderBottomToolbar},r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},placeholder:"Kategorie:",value:this.state.tmpEntry.category,onChange:e=>this.setState({tmpEntry:Object.assign(this.state.tmpEntry,{category:e.target.value})})})),r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},type:"date",placeholder:"Datum:",value:this.normalizeDate(this.state.tmpEntry.date)})),r.a.createElement(u.Card,null,r.a.createElement(u.Input,{style:{width:"100%"},type:"number",placeholder:"Wert:",value:0!==this.state.tmpEntry.value?String(this.state.tmpEntry.value):void 0,onChange:e=>this.setState({tmpEntry:Object.assign(this.state.tmpEntry,{value:Number(e.target.value)})})})))}renderToolbar(){return r.a.createElement(u.Toolbar,null,r.a.createElement(u.ToolbarButton,null,r.a.createElement(u.BackButton,{onClick:()=>{this.setState({pagestate:"backToHome"})}})))}renderBottomToolbar(){return r.a.createElement(u.BottomToolbar,null,r.a.createElement(u.ToolbarButton,{style:{margin:0,padding:0,lineHeight:"44px",width:"100%",textAlign:"center"},onClick:this.handleSubmit},"Update"))}handleSubmit(){return X(this,void 0,void 0,function*(){z(this.state.tmpEntry),this.setState({pagestate:"backToHome"})})}normalizeDate(e){let t=new Date(e);return`${t.getFullYear()}-${this.lengthStr(t.getMonth().toString(),2)}-${this.lengthStr(t.getDate().toString(),2)}`}lengthStr(e,t){for(;e.length<t;)e="0"+e;return e}}n(35);var Q=function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function l(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,l)}c((a=a.apply(e,t||[])).next())})};v.log("Start app"),o.a.render(r.a.createElement(function(){return r.a.createElement(U.a,{store:O},r.a.createElement(l.a,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(c.a,{exact:!0,path:"/",component:J}),r.a.createElement(c.a,{exact:!0,path:"/add",component:K}),r.a.createElement(c.a,{path:"/edit/:entry_id",component:G}))))},null),document.getElementById("app")),(()=>Q(void 0,void 0,void 0,function*(){yield N(),yield j()}))(),"serviceWorker"in window.navigator&&navigator.serviceWorker.register("sw.js")}});
//# sourceMappingURL=pwa.0.1.2.js.map